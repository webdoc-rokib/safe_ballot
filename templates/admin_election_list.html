{% extends 'base.html' %}
{% block page_icon %}
  <svg class="icon-sm" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" aria-hidden="true"><path d="M4 7h16M4 12h16M7 17h10" stroke="currentColor" stroke-width="1.4" stroke-linecap="round"/></svg>
{% endblock %}
{% block content %}
<div class="d-flex justify-content-between align-items-center mb-4">
  <div>
    <h2 class="mb-0">{{ status_title }} elections</h2>
    <div class="text-muted small">Manage {{ status }} elections and track turnout.</div>
  </div>
  <div class="d-flex">
    <a class="btn btn-outline-secondary me-2" href="{% url 'admin_dashboard' %}">Back to Dashboard</a>
    <a class="btn btn-primary" href="{% url 'create_election' %}">Create Election</a>
  </div>
  </div>

<div class="row g-3">
  {% for e in elections %}
    <div class="col-12">
      <div class="card elevation-1">
        <div class="card-body">
          <div class="d-flex justify-content-between align-items-start">
            <div>
              <h5 class="mb-1">{{ e.title }}</h5>
              <div class="small text-muted">Ends: {{ e.end_time }}</div>
              <div class="small text-muted">Turnout: <strong>{{ e.turnout_pct }}%</strong> â€” Votes: {{ e.votes_cast|default:0 }} / Eligible: {{ e.eligible|default:0 }}</div>
            </div>
              <div class="d-flex flex-wrap gap-2">
                <span class="badge rounded-pill text-bg-info">{{ e.candidates_count }} candidates</span>
                {% if user.is_superuser or e.created_by_id == user.id %}
                  <a href="{% url 'list_candidates' e.id %}" class="btn btn-sm btn-outline-secondary">Candidates</a>
                  <a href="{% url 'upload_voters' e.id %}" class="btn btn-sm btn-outline-secondary">Upload voters</a>
                  <a href="{% url 'edit_election' e.id %}" class="btn btn-sm btn-primary">Edit</a>
                  <a href="{% url 'rotate_publish_key' e.id %}" class="btn btn-sm btn-outline-secondary">Rotate key</a>
                  {% if e.status != 'concluded' %}
                    <a class="btn btn-sm btn-warning" href="{% url 'publish_results' e.id %}">Publish</a>
                  {% else %}
                    <a class="btn btn-sm btn-success" href="{% url 'results' e.id %}">Results</a>
                  {% endif %}
                {% else %}
                  <span class="badge text-bg-secondary">View only</span>
                {% endif %}
            </div>
          </div>
        </div>
      </div>
    </div>
  {% empty %}
    <div class="col-12"><div class="alert alert-info">No {{ status }} elections.</div></div>
  {% endfor %}
</div>
{% endblock %}
